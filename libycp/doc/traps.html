<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>Traps and pitfalls in YCP</title>
  </head>

  <body bgcolor="white">

  <H1>Traps and pitfalls in YCP</H1>
This documents is a collection of common traps and pitfalls
encountered when programming with the YaST2 control language YCP.<BR>
<BR>
Remember, this is an interpreted language and some issues will
only surface at runtime.
<BR>
<P>
    <A name="alias">
    <h2>The alias trap</h2>
    </A>
This might be the deepest pitfall of YCP which you will fall into if you're
trying to be too clever when changing lists and maps.<BR>
<P>
Have a look at this code:<BR>
<PRE>
{
  map `m = $[1:11, 2:12, 3:13];	// define a map
  map `m1 = m;			// save the current status in a helper map
  `m[1] = 12;			// change the original map
  return (m == m1);		// this should return false ...
}
</PRE>
<P>
What would you expect ? Does the above code return true or false ?<BR>
<BR>
Well, it returns <b>true</b> because it triggers the alias trap.<BR>
<P>
Assignments in YCP don't copy complex values (like lists and maps) but
rather pass references (!). So in the above example, m1 doesn't hold a
copy of m but a reference.<BR>
Changing m also changes m1.<BR>
<P>
<H3>How to prevent the alias trap ?</H3>
<BR>
You can prevent the alias trap by referencing an intermediate value
instead of the original value. This is easily done by wrapping it
in <tt>eval()</tt>:<BR>
<P>
<PRE>
{
  map `m = $[1:11, 2:12, 3:13];	// define a map
  map `m1 = eval(m);		// reference the result of eval()
  `m[1] = 12;			// change the original map
  return (m == m1);		// this does return false.
}
</PRE>

<p>
<hr>
<address><a href="mailto:kkaempf@suse.de">Klaus K&auml;mpf</a></address>
Last modified: Wed Nov 27 11:42:21 MEST 2001
</body>
</html>
